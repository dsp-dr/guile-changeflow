#!/usr/bin/env bash

# Guile ChangeFlow Development Environment
# Sets up core tools and runs Makefile targets for validation

echo "🚀 Guile ChangeFlow Development Environment"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"

# Core environment variables
export GUILE_LOAD_PATH="$PWD/src:${GUILE_LOAD_PATH}"
export MCP_SERVER_PORT=8427
export MCP_SERVER_HOST="localhost"
export MCP_SERVER_URL="http://localhost:8427"
export NODE_ENV=development
export GUILE_ENV=development

# Run Makefile checks
echo "🔍 Running environment checks..."
if make check-env > /dev/null 2>&1; then
    echo "✅ Environment check passed"
else
    echo "⚠️  Environment check failed - run 'make check-env' for details"
fi

# Check if MCP server is running (don't auto-start to avoid hangs)
if curl -s http://localhost:8427/ > /dev/null 2>&1; then
    echo "✅ MCP server already running on port 8427"
else
    echo "ℹ️  MCP server not running - run 'make mcp-server' to start"
fi

# Display available targets
echo ""
echo "📋 Available Makefile targets:"
echo "   make help         - Show all available targets"
echo "   make test         - Run test suite"
echo "   make mcp-server   - Start MCP server"
echo "   make deploy       - Deploy to Cloudflare"
echo "   make clean        - Clean build artifacts"
echo ""
echo "Ready for development! 🎉"